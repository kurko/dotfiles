#!/bin/bash
LOG="/tmp/prompt-color-attention.log"
echo "$(date): called with args: $@" >> "$LOG"
echo "  TMUX=$TMUX" >> "$LOG"
echo "  ANNOYING_COLOR_ALERT=$ANNOYING_COLOR_ALERT" >> "$LOG"
#
# Changes tmux pane background to grab attention when a program needs input.
# Use ANNOYING_COLOR_ALERT=1 to enable.
#
# Usage:
#   prompt-color-attention           # Activates attention color (if enabled)
#   prompt-color-attention --disable # Resets to default
#
# Color alternatives:
#   Green (current): bg=#74C476,fg=#00441B
#   Dark orange:     bg=#3d2000,fg=#ffffff
#   Bright orange:   bg=#FF8C00,fg=#000000
#   Red alert:       bg=#8B0000,fg=#ffffff
#   Yellow:          bg=#FFD700,fg=#000000

if [[ -z "$TMUX" ]]; then
  echo "This script must be run inside a tmux session."
  exit 0
fi

# Use exported pane ID if available (from prompt-attention wrapper),
# otherwise detect dynamically
if [[ -n "$ANNOYING_PANE_ID" ]]; then
  PANE_ID="$ANNOYING_PANE_ID"
else
  PANE_ID=$(tmux display-message -p '#{pane_id}' | tr -d '%')
fi

if [[ "$1" == "--disable" ]]; then
  tmux select-pane -t "%$PANE_ID" -P 'bg=default,fg=default'
  exit 0
fi
ALERT_FLAG_FILE="/tmp/annoying-color-alert-$PANE_ID"
echo "  PANE_ID=$PANE_ID ALERT_FLAG_FILE=$ALERT_FLAG_FILE exists=$(test -f "$ALERT_FLAG_FILE" && echo yes || echo no)" >> "$LOG"

if [[ "$ANNOYING_COLOR_ALERT" == "1" ]] || [[ -f "$ALERT_FLAG_FILE" ]]; then
  echo "Setting tmux pane to attention color."
  tmux select-pane -t "%$PANE_ID" -P 'bg=#FF8C00,fg=#ffffff'
else
  echo "ANNOYING_COLOR_ALERT is not enabled. No changes made."
fi
